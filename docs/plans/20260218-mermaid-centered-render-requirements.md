# 20260218 Mermaid 중앙 정렬 렌더 요구사항 (PLAN)

- 현재 상태: `CLOSED`
- 작업 ID: `20260218-mermaid-centered-render-requirements`
- 최신 동기화 커밋(파일 최신 커밋 기준): `git log --oneline -- docs/plans/20260218-mermaid-centered-render-requirements.md | head -n 1` 실행 결과

## 배경
- 현재 Mermaid 블록이 일반 코드 블록(`.code-block`)과 동일한 프레임/헤더 스타일을 공유해 문서 본문 다이어그램으로 보기에 답답해 보인다.
- 다이어그램 자체가 좌측에 붙어 보이거나, 코드 블록 스타일 영향으로 시각적 중심이 흐트러져 보인다.
- 목표는 Mermaid를 "코드"가 아닌 "도표"로 보이게 하면서, 본문 중앙 정렬과 가독성을 확보하는 것이다.

## 목표/범위
- 범위
  - Mermaid 코드펜스 렌더 시 일반 코드 블록 CSS를 적용하지 않는다.
  - Mermaid 다이어그램을 본문 영역에서 깔끔하게 중앙 정렬한다.
  - 모바일/데스크톱에서 모두 레이아웃 깨짐 없이 렌더한다.
  - 실패 시 오류 메시지는 유지하되, 다이어그램 영역 문맥에서 자연스럽게 노출한다.
- 비범위
  - Mermaid 구문 자체 자동 교정/포맷터 도입
  - Mermaid 외 일반 코드 블록(UI 헤더/복사 버튼 포함) 스타일 변경

## 기능 요구사항
1. Mermaid 블록은 코드 블록과 분리된 전용 컨테이너 마크업을 사용한다.
2. Mermaid 블록에는 `code-header`, 파일명, 복사 버튼 등 코드 전용 UI를 표시하지 않는다.
3. Mermaid 블록은 `.code-block pre code` 계열 스타일 영향을 받지 않도록 CSS 우선순위를 분리한다.
4. 렌더된 `svg`는 가로 중앙 정렬되고, 필요 시 `max-width` 기준으로 축소되어 뷰포트 밖으로 넘치지 않는다.
5. 작은 화면에서는 가로 스크롤보다 "가독성 유지"를 우선하며, 다이어그램 잘림이 없어야 한다.
6. Mermaid 렌더 실패 시 현재 오류 문구 정책은 유지하되, 전용 컨테이너 하단에서 일관된 스타일로 보여준다.
7. Mermaid 비활성화(`enabled=false`) 시 기존처럼 원본 코드 텍스트를 보되, 전용 컨테이너 레이아웃은 유지한다.

## 완료 기준 (Definition of Done)
- 샘플 문서의 Mermaid 다이어그램이 코드 블록 헤더 없이 본문 중앙에 렌더된다.
- 다이어그램이 긴 경우에도 데스크톱/모바일에서 컨테이너 폭 안에 표시되며 잘리지 않는다.
- 일반 코드 블록(mermaid 제외)의 UI/스타일/복사 기능 회귀가 없다.
- Mermaid 비활성화/렌더 실패 시 사용자 메시지가 의도대로 노출된다.
- README(ko/en) 또는 운영 문서에 Mermaid 렌더 정책(코드 스타일 분리 + 중앙 정렬) 설명이 반영된다.

## 변경 대상 후보
- `src/markdown.ts`
- `src/runtime/app.css`
- `src/runtime/app.js`
- `tests/e2e/mermaid-runtime.spec.ts`
- `README.md`
- `README.ko.md`

## 단계별 작업 체크리스트
- [x] Mermaid fence 출력 마크업을 코드 블록과 분리
- [x] Mermaid 전용 CSS 레이어 정의(중앙 정렬/반응형/실패 메시지)
- [x] 런타임 렌더 후 `svg` 정렬/폭 제약 확인 및 보정
- [x] E2E 회귀 테스트 추가 또는 기존 테스트 확장
- [x] 문서(README) 정책 업데이트

## 테스트 계획
- 자동
  - `tests/e2e/mermaid-runtime.spec.ts`에 아래 검증 추가/보강
    - Mermaid 블록에 코드 헤더/복사 버튼이 보이지 않는지
    - 렌더된 `svg`가 중앙 정렬인지(CSS 클래스/계산 스타일 기준)
    - 모바일 뷰포트에서도 잘림 없이 표시되는지
- 수동
  - Mermaid 예제 문서 2~3개를 열어 데스크톱/모바일 레이아웃 확인
  - Mermaid 비활성화 및 강제 실패(CDN 오류) 시 메시지 노출 확인

## 리스크/회귀 포인트
- 기존 `.code-block` 공통 스타일과 분리하면서 선택자 우선순위 충돌 가능성
- Mermaid가 생성하는 `svg` 내부 크기 속성(width/height/viewBox)과 외부 컨테이너 규칙 충돌 가능성
- 테마(라이트/다크) 전환 시 Mermaid 테마와 컨테이너 배경 대비 이슈 가능성

## 대응 전략
- Mermaid 전용 클래스 네이밍을 명확히 분리해 CSS 누수 방지
- E2E에서 DOM 구조/스타일 회귀를 함께 검증
- 라이트/다크 각각 최소 1개 예제 문서 스냅샷 확인
